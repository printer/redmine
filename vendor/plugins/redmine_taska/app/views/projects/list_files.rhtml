<div class="contextual">
<%= link_to_if_authorized l(:label_attachment_new), {:controller => 'projects', :action => 'add_file', :id => @project}, :class => 'icon icon-add' %>
</div>

<h2><%=l(:label_attachment_plural)%></h2>

<% delete_allowed = User.current.allowed_to?(:manage_files, @project) %>

<table class="list files">
  <thead><tr>
    <%= sort_header_tag('filename', :caption => l(:field_filename)) %>
    <%= sort_header_tag('created_on', :caption => l(:label_date), :default_order => 'desc') %>
    <%= sort_header_tag('size', :caption => l(:field_filesize), :default_order => 'desc') %>
    <%= sort_header_tag('downloads', :caption => l(:label_downloads_abbr), :default_order => 'desc') %>
    <th>MD5</th>
    <th></th>
  </tr></thead>
  <tbody>
  <% @files.each do |date,list| %>	
  <tr>
    <th colspan="6" align="left">
      <%= format_activity_day(date) %>
    </th>
  </tr>
  <% list.each do |file| %>		
  <tr class="file <%= cycle("odd", "even") %>">
    <td class="filename"><%= link_to_attachment file, :download => true, :title => file.description %></td>
    <td class="created_on"><%= format_time(file.created_on) %></td>
    <td class="filesize"><%= number_to_human_size(file.filesize) %></td>
    <td class="downloads"><%= file.downloads %></td>
    <td class="digest"><%= file.digest %></td>
    <td align="center">
    <%= link_to(image_tag('delete.png'), {:controller => 'attachments', :action => 'destroy', :id => file},
																				 :confirm => l(:text_are_you_sure), :method => :post) if delete_allowed %>
    </td>
  </tr>		
  <% end
  reset_cycle %>
<% end %>
  </tbody>
</table>

<% content_for :sidebar do %>
<h3><%= l(:field_category) %></h3>
<% form_tag({}, :method => :get) do %>
<label><%= radio_button_tag 'filter', '', (@filter.blank?), :onclick => 'this.form.submit();' %> <%= l(:label_attachments_all).classify %></label><br />
<label><%= radio_button_tag 'filter', 'documents', (@filter == 'documents'), :onclick => 'this.form.submit();' %> <%= l(:label_attachments_documents) %></label>
<% end %>
<% end %>

<% html_title(l(:label_attachment_plural)) -%>
